# Claude Code Hooks Configuration
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è‡ªå‹•åŒ–ã‚’å®šç¾©ã—ã¾ã™

hooks:
  # ã‚³ãƒ¼ãƒ‰å“è³ªã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯
  - event: PostToolUse
    matcher:
      tool: [Edit, Write, MultiEdit]
      glob: "*.{js,ts,jsx,tsx,py}"
    command: |
      # ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’ãƒ­ã‚°ã«è¨˜éŒ²ï¼ˆå¿…è¦ã«å¿œã˜ã¦æœ‰åŠ¹åŒ–ï¼‰
      # echo "[$(date '+%Y-%m-%d %H:%M')] ã‚³ãƒ¼ãƒ‰å¤‰æ›´: $CLAUDE_FILE_PATHS" >> .claude/logs/changes.log
      # è¨€èªžåˆ¥ã®å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆå­˜åœ¨ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã®ã¿å®Ÿè¡Œï¼‰
      if command -v npm >/dev/null 2>&1 && [ -f package.json ]; then
        npm run lint --if-present
        npm run typecheck --if-present
      elif command -v python >/dev/null 2>&1 && [ -f requirements.txt ]; then
        python -m flake8 $CLAUDE_FILE_PATHS 2>/dev/null || true
        python -m mypy $CLAUDE_FILE_PATHS 2>/dev/null || true
      fi

  # ãƒ†ã‚¹ãƒˆæˆåŠŸæ™‚ã®è‡ªå‹•è¨˜éŒ²
  - event: PostToolUse
    matcher:
      tool: Bash
      command_contains: "test"
    command: |14
      if [ $CLAUDE_EXIT_CODE -eq 0 ]; then
        echo "### $(date '+%Y-%m-%d %H:%M') - ãƒ†ã‚¹ãƒˆæˆåŠŸ" >> .claude/context/history.md
        echo "- ã‚³ãƒžãƒ³ãƒ‰: $CLAUDE_COMMAND" >> .claude/context/history.md
        echo "" >> .claude/context/history.md
      fi

  # æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®è¨˜éŒ²
  - event: PostToolUse
    matcher:
      tool: [Write, MultiEdit]
      glob: "*.{js,ts,jsx,tsx,py}"
    command: |
      # æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚ŒãŸå ´åˆ
      if [ "$CLAUDE_TOOL" = "Write" ]; then
        # æ–°æ©Ÿèƒ½è¿½åŠ ã‚’ãƒ­ã‚°ã«è¨˜éŒ²ï¼ˆå¿…è¦ã«å¿œã˜ã¦æœ‰åŠ¹åŒ–ï¼‰
        # echo "### $(date '+%Y-%m-%d') - æ–°æ©Ÿèƒ½è¿½åŠ : $CLAUDE_FILE_PATHS" >> .claude/logs/features.log
      fi

  # gitæ“ä½œã®è‡ªå‹•è¨˜éŒ²
  - event: PostToolUse
    matcher:
      tool: Bash
      command_contains: "git commit"
    command: |
      if [ $CLAUDE_EXIT_CODE -eq 0 ]; then
        # ã‚³ãƒŸãƒƒãƒˆã‚’ãƒ­ã‚°ã«è¨˜éŒ²ï¼ˆå¿…è¦ã«å¿œã˜ã¦æœ‰åŠ¹åŒ–ï¼‰
        # echo "### $(date '+%Y-%m-%d %H:%M') - ã‚³ãƒŸãƒƒãƒˆ" >> .claude/logs/commits.log
        # echo "$CLAUDE_OUTPUT" >> .claude/logs/commits.log
      fi

  # Memory Bank 2.0: MarkdownåŒæœŸ
  - event: PostToolUse
    matcher:
      tool: [Edit, Write, MultiEdit]
      glob: ".claude/**/*.md"
    command: |
      # Markdownãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«çŸ¥è­˜DBã¨åŒæœŸ
      if command -v python3 >/dev/null 2>&1; then
        echo "ðŸ“ Memory BankåŒæœŸä¸­..."
        python3 .claude/index/sync_markdown.py
      fi

  # Phase 3: AIç”Ÿæˆã‚³ãƒ¼ãƒ‰å“è³ªãƒ¢ãƒ‹ã‚¿ãƒ¼
  - event: PostToolUse
    matcher:
      tool: [Write, Edit]
      glob: "*.py"
    command: |
      # Pythonãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯
      if command -v python3 >/dev/null 2>&1 && [ -f .claude/quality/code_monitor.py ]; then
        echo "ðŸ” ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ä¸­..."
        python3 .claude/quality/code_monitor.py check "$CLAUDE_FILE_PATHS" || true
      fi

  # Phase 3: çŸ¥è­˜è‡ªå‹•æ•´ç†ï¼ˆé€±1å›žï¼‰
  - event: SessionStart
    command: |
      # æœ€å¾Œã®æ•´ç†ã‹ã‚‰7æ—¥çµŒéŽã—ã¦ã„ãŸã‚‰å®Ÿè¡Œ
      if [ ! -f .claude/index/.last_organize ] || \
         [ $(find .claude/index/.last_organize -mtime +7 2>/dev/null | wc -l) -gt 0 ]; then
        if command -v python3 >/dev/null 2>&1 && [ -f .claude/index/auto_organize.py ]; then
          echo "ðŸ—‚ï¸  çŸ¥è­˜ãƒ™ãƒ¼ã‚¹æ•´ç†ä¸­..."
          python3 .claude/index/auto_organize.py organize >/dev/null 2>&1 || true
          touch .claude/index/.last_organize
        fi
      fi

  # Phase 3: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆè»½é‡ç‰ˆï¼‰
  - event: PostToolUse
    matcher:
      tool: [Write, Edit]
      glob: "*.{js,ts,jsx,tsx}"
    command: |
      # JavaScript/TypeScriptãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã®ç°¡æ˜“ãƒã‚§ãƒƒã‚¯
      if command -v python3 >/dev/null 2>&1 && [ -f .claude/quality/code_monitor.py ]; then
        python3 .claude/quality/code_monitor.py check "$CLAUDE_FILE_PATHS" | grep -E "(duplicate_found|suggestions)" || true
      fi

# ç’°å¢ƒå¤‰æ•°è¨­å®š
env:
  CLAUDE_HOOKS_ENABLED: true
  CLAUDE_PROJECT_ROOT: $PWD